---
- name: users ansible | create group
  group:
    name: ansible
    system: yes
    state: present

- name: users ansible | create user
  user:
    name: ansible
    system: yes
    state: present
    shell: /bin/bash

- name: users ansible | authorized key
  authorized_key:
    user: ansible
    key: "{{ dvrg_ssh_key}}"
    state: present

- name: users ansible | sudoerd.d
  copy:
    src: sudo/ansible
    dest: /etc/sudoers.d/ansible
    owner: root
    group: root
    mode: 0660

#
# Setup ansible.service and ansible.timer
#
- name: users ansible | install ansible.service
  copy:
    src: systemd/ansible.service
    dest: /etc/systemd/system
    owner: root
    group: root
    mode: 0664
  register: ansible_service

- name: users ansible | install ansible.timer
  copy:
    src: systemd/ansible.timer
    dest: /etc/systemd/system
    owner: root
    group: root
    mode: 0664
  notify: ansible_timer

- name: users ansible | enable ansible.service
  systemd:
    name: ansible.service
    enabled: no
    state: stopped
    daemon_reload: yes
  when: ansible_service is succeeded

- name: users ansible | enable ansible.timer
  systemd:
    name: ansible.timer
    enabled: yes
    state: started
  when: ansible_timer is succeeded
